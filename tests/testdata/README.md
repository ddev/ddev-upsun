# Test Fixtures

## Overview

Test fixtures in this directory come from branches of https://github.com/ddev/test-upsun-addon.

**Note:** Only essential configuration files are checked into git. Generated code (web/, vendor/) is gitignored and must be regenerated when needed.

## What's Tracked in Git

Each fixture directory contains only:
- `composer.json` / `composer.lock` - PHP dependencies
- `.upsun/config.yaml` or `.platform*` files - Platform configuration
- `config/sync/` - Drupal configuration exports
- `drush/` - Deployment scripts
- `.environment` - Environment variable mappings
- `db.sql.gz` - Database dumps (1.7 MB each)

## What's NOT Tracked (Gitignored)

- `web/` - Drupal core and contributed modules (~130 MB per fixture)
- `vendor/` - Composer dependencies
- `.ddev/` - DDEV configuration (generated by tests)

## Regenerating Fixtures for Testing

When tests run, they use the fixture directories as-is. The `web/` directories exist on disk for developers but aren't tracked in git. To regenerate a fixture's web/ directory:

```bash
cd tests/testdata/drupal11-mariadb-fixed
composer install --no-dev --no-interaction
```

## Managing Fixtures with Git Subtrees

### Adding New Fixtures

```bash
git subtree add --prefix=tests/testdata/<fixture> \
  https://github.com/ddev/test-upsun-addon <fixture> --squash
```

Example:
```bash
git subtree add --prefix=tests/testdata/drupal11-mysql-flex \
  https://github.com/ddev/test-upsun-addon drupal11-mysql-flex --squash
```

### Updating Existing Fixtures

```bash
# Fetch the upstream repo
git fetch https://github.com/ddev/test-upsun-addon

# Pull into subtree (only config files will be updated)
git subtree pull --prefix=tests/testdata/<fixture> \
  https://github.com/ddev/test-upsun-addon <fixture> --squash
```

**Note:** After pulling updates, the web/ directory on disk won't be updated (it's gitignored). Either run `composer install` in the fixture directory or delete it to force regeneration during tests.

## Rationale

This approach reduces repository size from ~800 MB to ~10 MB while keeping all essential configuration needed for testing. The Drupal core files can be regenerated deterministically from composer.lock.